<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Course Details</title>
		<link
			rel="stylesheet"
			href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
		<style>
			.course-photo {
				height: 300px;
				object-fit: cover;
				width: 100%;
			}
		</style>
	</head>
	<body>
		<div class="container mt-5">
			<div th:if="${course != null}">
				<div class="card">
					<img
						th:src="@{${course.linkPhoto}}"
						class="card-img-top course-photo"
						th:alt="${course.category}" />
					<div class="card-body">
						<h5 class="card-title" th:text="${course.title}">Course Name</h5>
						<p class="card-text">
							<strong>Category:</strong>
							<span th:text="${course.category}">Category Name</span>
						</p>
						<p class="card-text">
							<strong>Price:</strong>
							<span th:text="${course.price}">Price</span>
						</p>
						<p class="card-text">
							<strong>Mentor:</strong>
							<span th:text="${course.mentor}">Mentor Name</span>
						</p>
						<p class="card-text">
							<strong>Level:</strong>
							<span th:text="${course.level}">Level</span>
						</p>
						<p class="card-text">
							<strong>Total Duration:</strong>
							<span th:text="${course.totalDuration}">Total Duration</span>
							minutes
						</p>
						<p class="card-text">
							<strong>Status:</strong>
							<span th:text="${course.isPremium}">Status</span>
						</p>
						<p class="card-text">
							<strong>About the Course:</strong>
							<span th:text="${course.about}">Course Description</span>
						</p>
						<h5>Course Videos:</h5>
						<ul class="list-group">
							<li
								class="list-group-item"
								th:each="video : ${course.moduleResponses}">
								<span th:text="${video.name}">Video Title</span>
								<button
									class="btn btn-link"
									data-toggle="modal"
									data-target="#videoModal"
									th:data-video-link="@{${video.content}}">
									Watch
								</button>
							</li>
						</ul>
						<a
							class="fw-bold fs-5 text-secondary text-decoration-none"
							href="/home"
							>‚Üê Kelas Lainnya</a
						>
					</div>
				</div>
			</div>
			<div th:if="${course == null}">
				<p>No course details available.</p>
			</div>
		</div>

		<!-- Video Player Modal -->
		<div
			class="modal fade"
			id="videoModal"
			tabindex="-1"
			role="dialog"
			aria-labelledby="videoModalLabel"
			aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="videoModalLabel">Video Player</h5>
						<button
							type="button"
							class="close"
							data-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<iframe
							id="courseVideo"
							width="100%"
							height="315"
							frameborder="0"
							allowfullscreen></iframe>
					</div>
				</div>
			</div>
		</div>

		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
		<script>
			function getYouTubeEmbedLink(videoLink) {
				let videoId = "";
				const regex =
					/^.*(?:youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
				const match = videoLink.match(regex);
				if (match && match[1].length === 11) {
					videoId = match[1];
				}
				return "https://www.youtube.com/embed/" + videoId;
			}

			$("#videoModal").on("show.bs.modal", function (event) {
				var button = $(event.relatedTarget);
				var videoLink = button.data("video-link");
				var embedLink = getYouTubeEmbedLink(videoLink);
				var modal = $(this);
				modal.find(".modal-body #courseVideo").attr("src", embedLink);
			});

			$("#videoModal").on("hidden.bs.modal", function () {
				var modal = $(this);
				modal.find(".modal-body #courseVideo").attr("src", "");
			});
		</script>
	</body>
</html>
